### 仕様書：dataset_splitter

1. 目的
- 大規模なデータセットを指定されたサイズに分割し、処理可能な小さなファイルに変換する。
- 分割されたファイルを並列に処理することで、処理速度を向上させる。
2. 機能
- 指定されたデータセットから、指定されたサイズのファイルを生成する。
- データセットは、JSONL形式またはTXT形式に対応する。
- 生成されたファイルは、JSONL形式またはTXT形式で出力される。
- データセットを分割する際、データはランダムにシャッフルされる。
- 分割されたファイルの統計情報（ファイルパス、ファイルサイズ）を収集し、CSVファイルに出力する。
3. 設定
- データセットのパス
- コーパス名（複数指定可）
- 出力ファイルのサイズ（GB単位）
- 出力ファイルのパス
- 入力ファイルの拡張子（JSONL、TXT）
- 出力ファイルの拡張子（JSONL、TXT）
- 分割方法（split_all、split_all_with_count）
- 統計情報の出力先ディレクトリ
4. 制約
- 入力データセットは、JSONL形式またはTXT形式である必要がある。
- 出力ファイルのサイズは、指定されたサイズ以下になるように調整される。
- 分割されたファイルの数は、データセットのサイズと指定されたファイルサイズによって決定される。
- 並列処理の度合いは、システムのリソースに依存する。
### 手順書：データセット分割ツールの使用方法

1. 設定ファイル（dataset_split_settings.csv）を準備する。
- dataset_path：データセットのパス
- corpus_name：コーパス名（複数の場合はカンマ区切り）
- size：出力ファイルのサイズ（GB単位）
- dst_dataset_path：出力ファイルのパス
- extension：入力ファイルの拡張子（JSONL、TXT）
- method：分割方法（split_all、split_all_with_count）
- output_extension：出力ファイルの拡張子（JSONL、TXT）
- selected_files_dir：統計情報の出力先ディレクトリ
3. データセット分割ツールを実行する。
python dataset_splitter.py
4. 処理の進行状況がコンソールに表示される。
- 読み込まれたデータ項目の数
- データの合計サイズ
- 生成されるファイルの数
- 処理中のファイル情報
- 出力ファイルのパスとサイズ
- 選択されたデータ項目の数
- 処理時間
5. 出力ファイルを確認する。
- 出力ファイル：{dst_dataset_path}/{dataset_name}_{corpus_name}_{method}_{size}.{output_extension}
    - dataset_name：入力データセットの名前（パスからファイル名を抽出）
    - corpus_name：コーパス名（複数の場合は_で連結）
    - method：分割方法（split_all、split_all_with_count）
    - size：出力ファイルのサイズ（GB単位）
    - output_extension：出力ファイルの拡張子（jsonl、txt）
- 統計情報ファイル：{selected_files_dir}/{dataset_name}/{corpus_name}/{method}/selected_files_{dataset_name}_{corpus_name}_{method}_{size}.csv
    - selected_files_dir：統計情報の出力先ディレクトリ
    - dataset_name：入力データセットの名前（パスからファイル名を抽出）
    - corpus_name：コーパス名（複数の場合は_で連結）
    - method：分割方法（split_all、split_all_with_count）
    - size：出力ファイルのサイズ（GB単位）
6. 分割方法の詳細
- split_file：
    - 指定されたサイズ以下のファイルを選択し、そのファイルからデータを読み込む。
    - 指定されたサイズ以下のファイルがない場合は、サイズ制限より大きいファイルからランダムに1つ選択する。
    - 選択されたファイルからデータを読み込み、ランダムにシャッフルする。
    - シャッフルされたデータから、指定されたサイズになるまでデータを選択する。
- split_all：
    - すべてのファイルからデータを読み込み、ランダムにシャッフルする。
    - シャッフルされたデータから、指定されたサイズになるまでデータを選択する。
    - 大規模なデータセットの場合、メモリ使用量が増大する可能性があるため注意が必要。
- split_all_with_count：
    - すべてのファイルを並列に処理する。
    - 各ファイルに対して、ファイルサイズに基づいて確率的にデータを選択する。
    - 選択されたデータを出力ファイルに書き込む。
    - 並列処理により、処理速度が向上する。
6. 出力情報を確認 
- 指定された出力先ディレクトリ（selected_files_dir）に、CSVファイルが生成される。- 
- CSVファイルのパスは、{selected_files_dir}/{dataset_name}/{corpus_name}/{method}/selected_files_{dataset_name}_{corpus_name}_{method}_{size}.csvの形式で生成される。
- CSVファイルには、分割されたファイルのパスとサイズが記録される。(slide_fileとｓlide_all_with_count）
7. 注意事項
- split_all方法は、大規模なデータセットに対して使用する場合、メモリ使用量が増大する可能性があります。必要に応じて、バッチ処理などの最適化を検討してください。
- split_all_with_count方法は、並列処理を行うため、システムのリソースに応じて適切な並列度を選択してください。出力先ディレクトリに、CSVファイルが生成される。
- CSVファイルには、分割されたファイルのパスとサイズが記録される。


