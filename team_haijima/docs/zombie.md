# ゾンビプロセス撃退法

- プログラムが終了してもプロセスが残ってしまう事がある。
- 特にGPUを使うプロセスが残っている場合に学習を再開させてもエラーとなってしまう。
- その場合の対処法を記載する。

## 計算ノードへのログイン

- まずは計算ノードにログインする。
  - 各ノード単位に処理する必要があるため一つずつログインする。(node-6、node-7、node-8)
  - GPUを確保しないとnvidia-smiが使えないため、`--gpus-per-node=8`を指定する。

```bash
srun --partition a3 --nodes=1 --gpus-per-node=8 --nodelist=slurm0-a3-ghpc-6 --pty bash -i
```

## ゾンビプロセスの確認

- 以下のコマンドを使ってプロセスが残っていないか確認する。

```bash
nvidia-smi
```

## ゾンビプロセスの削除

- 以下のコマンドを使ってプロセスを削除する。
- なお、通常 nvidia-smiの一番上のプロセスを消すと、残りのプロセスも消える傾向にある。
- 多少待っても消えない場合は、順次プロセスを消す。

```
sudo kill <pid>
```

## その他、プロセス

- 正しく表示されない、または、wandbのプロセスが残っているケースがあるとのこと。
  - squeue上はジョブが無いのにwandbとしては実行中となっている状態。
- その場合は、以下のコマンドを使ってプロセスを削除する。

```bash
pkill wandb
```

- nvidiaのデバイスを使用しているプロセスの確認
  - 個人アカウントで使用しているプロセスがいる場合には、同様に`kill`を行う。

```bash
sudo fuser -v /dev/nvidia*
```
